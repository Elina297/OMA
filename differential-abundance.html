<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 11 Differential Abundance | Orchestrating Microbiome Analysis</title>
  <meta name="description" content="Chapter 11 Differential Abundance | Orchestrating Microbiome Analysis" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 11 Differential Abundance | Orchestrating Microbiome Analysis" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://github.com/microbiome/OMA" />
  
  
  <meta name="github-repo" content="microbiome/OMA" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 11 Differential Abundance | Orchestrating Microbiome Analysis" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="community-typing.html"/>
<link rel="next" href="multitable.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.4.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Orchestrating Microbiome Analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="" data-path="introduction-to-bioconductor-classes.html"><a href="introduction-to-bioconductor-classes.html"><i class="fa fa-check"></i>Introduction to Bioconductor Classes</a></li>
<li class="part"><span><b>I Introduction</b></span></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#community"><i class="fa fa-check"></i><b>1.1</b> Community</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#developers-and-contributors"><i class="fa fa-check"></i><b>1.2</b> Developers and contributors</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#acknowledgements"><i class="fa fa-check"></i><b>1.3</b> Acknowledgements</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#package-ecosystem"><i class="fa fa-check"></i><b>1.4</b> Package ecosystem</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-introduction.html"><a href="data-introduction.html"><i class="fa fa-check"></i><b>2</b> Data Infrastructure</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-introduction.html"><a href="data-introduction.html#installation"><i class="fa fa-check"></i><b>2.1</b> Installation</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="data-introduction.html"><a href="data-introduction.html#packages"><i class="fa fa-check"></i><b>2.1.1</b> Packages</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="data-introduction.html"><a href="data-introduction.html#background"><i class="fa fa-check"></i><b>2.2</b> Background</a></li>
<li class="chapter" data-level="2.3" data-path="data-introduction.html"><a href="data-introduction.html#loading-experimental-microbiome-data"><i class="fa fa-check"></i><b>2.3</b> Loading experimental microbiome data</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="data-introduction.html"><a href="data-introduction.html#importing-data-from-external-files"><i class="fa fa-check"></i><b>2.3.1</b> Importing data from external files</a></li>
<li class="chapter" data-level="2.3.2" data-path="data-introduction.html"><a href="data-introduction.html#conversions-between-data-formats-in-r"><i class="fa fa-check"></i><b>2.3.2</b> Conversions between data formats in R</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="data-introduction.html"><a href="data-introduction.html#metadata"><i class="fa fa-check"></i><b>2.4</b> Metadata</a></li>
<li class="chapter" data-level="2.5" data-path="data-introduction.html"><a href="data-introduction.html#microbiome-and-tree-data-specific-aspects"><i class="fa fa-check"></i><b>2.5</b> Microbiome and tree data specific aspects</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="data-introduction.html"><a href="data-introduction.html#assays"><i class="fa fa-check"></i><b>2.5.1</b> Assays</a></li>
<li class="chapter" data-level="2.5.2" data-path="data-introduction.html"><a href="data-introduction.html#coldata"><i class="fa fa-check"></i><b>2.5.2</b> colData</a></li>
<li class="chapter" data-level="2.5.3" data-path="data-introduction.html"><a href="data-introduction.html#rowdata"><i class="fa fa-check"></i><b>2.5.3</b> rowData</a></li>
<li class="chapter" data-level="2.5.4" data-path="data-introduction.html"><a href="data-introduction.html#rowtree"><i class="fa fa-check"></i><b>2.5.4</b> rowTree</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="data-introduction.html"><a href="data-introduction.html#data-manipulation"><i class="fa fa-check"></i><b>2.6</b> Data manipulation</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="data-introduction.html"><a href="data-introduction.html#tidy-data"><i class="fa fa-check"></i><b>2.6.1</b> Tidy data</a></li>
<li class="chapter" data-level="2.6.2" data-path="data-introduction.html"><a href="data-introduction.html#subsetting"><i class="fa fa-check"></i><b>2.6.2</b> Subsetting</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="data-introduction.html"><a href="data-introduction.html#conclusion"><i class="fa fa-check"></i><b>2.7</b> Conclusion</a></li>
<li class="chapter" data-level="2.8" data-path="data-introduction.html"><a href="data-introduction.html#additional-reading"><i class="fa fa-check"></i><b>2.8</b> Additional Reading</a>
<ul>
<li class="chapter" data-level="2.8.1" data-path="data-introduction.html"><a href="data-introduction.html#lecture-slides"><i class="fa fa-check"></i><b>2.8.1</b> Lecture slides</a></li>
<li class="chapter" data-level="2.8.2" data-path="data-introduction.html"><a href="data-introduction.html#r-programming-resources"><i class="fa fa-check"></i><b>2.8.2</b> R programming resources</a></li>
<li class="chapter" data-level="2.8.3" data-path="data-introduction.html"><a href="data-introduction.html#resources-for-treesummarizedexperiment"><i class="fa fa-check"></i><b>2.8.3</b> Resources for TreeSummarizedExperiment</a></li>
<li class="chapter" data-level="2.8.4" data-path="data-introduction.html"><a href="data-introduction.html#resources-for-phyloseq"><i class="fa fa-check"></i><b>2.8.4</b> Resources for phyloseq</a></li>
<li class="chapter" data-level="2.8.5" data-path="data-introduction.html"><a href="data-introduction.html#further-reading"><i class="fa fa-check"></i><b>2.8.5</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="data-introduction.html"><a href="data-introduction.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="part"><span><b>II Focus Topics</b></span></li>
<li class="chapter" data-level="3" data-path="manipulation.html"><a href="manipulation.html"><i class="fa fa-check"></i><b>3</b> Data manipulation</a></li>
<li class="chapter" data-level="4" data-path="taxonomic-information.html"><a href="taxonomic-information.html"><i class="fa fa-check"></i><b>4</b> Taxonomic Information</a>
<ul>
<li class="chapter" data-level="4.1" data-path="taxonomic-information.html"><a href="taxonomic-information.html#assigning-taxonomic-information."><i class="fa fa-check"></i><b>4.1</b> Assigning taxonomic information.</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="taxonomic-information.html"><a href="taxonomic-information.html#dada2"><i class="fa fa-check"></i><b>4.1.1</b> dada2</a></li>
<li class="chapter" data-level="4.1.2" data-path="taxonomic-information.html"><a href="taxonomic-information.html#decipher"><i class="fa fa-check"></i><b>4.1.2</b> DECIPHER</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="taxonomic-information.html"><a href="taxonomic-information.html#functions-to-access-taxonomic-information"><i class="fa fa-check"></i><b>4.2</b> Functions to access taxonomic information</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="taxonomic-information.html"><a href="taxonomic-information.html#generate-a-taxonomic-tree-on-the-fly"><i class="fa fa-check"></i><b>4.2.1</b> Generate a taxonomic tree on the fly</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="taxonomic-information.html"><a href="taxonomic-information.html#data-agglomeration"><i class="fa fa-check"></i><b>4.3</b> Data agglomeration</a></li>
<li class="chapter" data-level="4.4" data-path="taxonomic-information.html"><a href="taxonomic-information.html#data-transformation"><i class="fa fa-check"></i><b>4.4</b> Data transformation</a></li>
<li class="chapter" data-level="4.5" data-path="taxonomic-information.html"><a href="taxonomic-information.html#pick-specific"><i class="fa fa-check"></i><b>4.5</b> Pick specific</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="taxonomic-information.html"><a href="taxonomic-information.html#abundances-of-all-taxa-in-specific-sample"><i class="fa fa-check"></i><b>4.5.1</b> Abundances of all taxa in specific sample</a></li>
<li class="chapter" data-level="4.5.2" data-path="taxonomic-information.html"><a href="taxonomic-information.html#abundances-of-specific-taxa-in-all-samples"><i class="fa fa-check"></i><b>4.5.2</b> Abundances of specific taxa in all samples</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="taxonomic-information.html"><a href="taxonomic-information.html#session-info-1"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="quality-control.html"><a href="quality-control.html"><i class="fa fa-check"></i><b>5</b> Quality Control</a>
<ul>
<li class="chapter" data-level="5.1" data-path="quality-control.html"><a href="quality-control.html#get-top-taxa-and-taxonomy"><i class="fa fa-check"></i><b>5.1</b> Get top taxa and taxonomy</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="quality-control.html"><a href="quality-control.html#features"><i class="fa fa-check"></i><b>5.1.1</b> Features</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="quality-control.html"><a href="quality-control.html#library-size"><i class="fa fa-check"></i><b>5.2</b> Library size</a></li>
<li class="chapter" data-level="" data-path="quality-control.html"><a href="quality-control.html#session-info-2"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="microbiome-exploration.html"><a href="microbiome-exploration.html"><i class="fa fa-check"></i><b>6</b> Microbiome Exploration</a>
<ul>
<li class="chapter" data-level="6.1" data-path="microbiome-exploration.html"><a href="microbiome-exploration.html#prevalence"><i class="fa fa-check"></i><b>6.1</b> Prevalence</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="microbiome-exploration.html"><a href="microbiome-exploration.html#prevalent-microbiota-analysis"><i class="fa fa-check"></i><b>6.1.1</b> Prevalent microbiota analysis</a></li>
<li class="chapter" data-level="6.1.2" data-path="microbiome-exploration.html"><a href="microbiome-exploration.html#plotting-prevalence"><i class="fa fa-check"></i><b>6.1.2</b> Plotting prevalence</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="microbiome-exploration.html"><a href="microbiome-exploration.html#abundance"><i class="fa fa-check"></i><b>6.2</b> Abundance</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="alpha-diversity.html"><a href="alpha-diversity.html"><i class="fa fa-check"></i><b>7</b> Alpha Diversity</a>
<ul>
<li class="chapter" data-level="7.1" data-path="alpha-diversity.html"><a href="alpha-diversity.html#estimating-alpha-diversity"><i class="fa fa-check"></i><b>7.1</b> Estimating alpha diversity</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="alpha-diversity.html"><a href="alpha-diversity.html#richness"><i class="fa fa-check"></i><b>7.1.1</b> Richness</a></li>
<li class="chapter" data-level="7.1.2" data-path="alpha-diversity.html"><a href="alpha-diversity.html#diversity"><i class="fa fa-check"></i><b>7.1.2</b> Diversity</a></li>
<li class="chapter" data-level="7.1.3" data-path="alpha-diversity.html"><a href="alpha-diversity.html#evenness"><i class="fa fa-check"></i><b>7.1.3</b> Evenness</a></li>
<li class="chapter" data-level="7.1.4" data-path="alpha-diversity.html"><a href="alpha-diversity.html#dominance"><i class="fa fa-check"></i><b>7.1.4</b> Dominance</a></li>
<li class="chapter" data-level="7.1.5" data-path="alpha-diversity.html"><a href="alpha-diversity.html#rarity"><i class="fa fa-check"></i><b>7.1.5</b> Rarity</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="alpha-diversity.html"><a href="alpha-diversity.html#visualize-alpha-diversities"><i class="fa fa-check"></i><b>7.2</b> Visualize alpha diversities</a></li>
<li class="chapter" data-level="" data-path="alpha-diversity.html"><a href="alpha-diversity.html#session-info-3"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="beta-diversity.html"><a href="beta-diversity.html"><i class="fa fa-check"></i><b>8</b> Beta Diversity</a>
<ul>
<li class="chapter" data-level="8.1" data-path="beta-diversity.html"><a href="beta-diversity.html#explained-variance"><i class="fa fa-check"></i><b>8.1</b> Explained variance</a></li>
<li class="chapter" data-level="8.2" data-path="beta-diversity.html"><a href="beta-diversity.html#estimating-beta-diversity"><i class="fa fa-check"></i><b>8.2</b> Estimating beta diversity</a></li>
<li class="chapter" data-level="8.3" data-path="beta-diversity.html"><a href="beta-diversity.html#other-ordination-methods"><i class="fa fa-check"></i><b>8.3</b> Other ordination methods</a></li>
<li class="chapter" data-level="8.4" data-path="beta-diversity.html"><a href="beta-diversity.html#visualizing-the-most-dominant-genus-on-pcoa"><i class="fa fa-check"></i><b>8.4</b> Visualizing the most dominant genus on PCoA</a></li>
<li class="chapter" data-level="8.5" data-path="beta-diversity.html"><a href="beta-diversity.html#community-comparisons-todo-combine-with-the-material-above-for-simplicity"><i class="fa fa-check"></i><b>8.5</b> Community comparisons [TODO combine with the material above for simplicity?]</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="beta-diversity.html"><a href="beta-diversity.html#testing-differences-in-community-composition-between-sample-groups"><i class="fa fa-check"></i><b>8.5.1</b> Testing differences in community composition between sample groups</a></li>
<li class="chapter" data-level="8.5.2" data-path="beta-diversity.html"><a href="beta-diversity.html#checking-the-homogeneity-condition"><i class="fa fa-check"></i><b>8.5.2</b> Checking the homogeneity condition</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="beta-diversity.html"><a href="beta-diversity.html#further-reading-1"><i class="fa fa-check"></i><b>8.6</b> Further reading</a></li>
<li class="chapter" data-level="" data-path="beta-diversity.html"><a href="beta-diversity.html#session-info-4"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="microbiome-community.html"><a href="microbiome-community.html"><i class="fa fa-check"></i><b>9</b> Microbiome Community</a>
<ul>
<li class="chapter" data-level="9.1" data-path="microbiome-community.html"><a href="microbiome-community.html#community-composition"><i class="fa fa-check"></i><b>9.1</b> Community composition</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="microbiome-community.html"><a href="microbiome-community.html#composition-barplot"><i class="fa fa-check"></i><b>9.1.1</b> Composition barplot</a></li>
<li class="chapter" data-level="9.1.2" data-path="microbiome-community.html"><a href="microbiome-community.html#composition-heatmap"><i class="fa fa-check"></i><b>9.1.2</b> Composition heatmap</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="microbiome-community.html"><a href="microbiome-community.html#session-info-5"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="community-typing.html"><a href="community-typing.html"><i class="fa fa-check"></i><b>10</b> Community typing</a>
<ul>
<li class="chapter" data-level="10.1" data-path="community-typing.html"><a href="community-typing.html#community-typing-1"><i class="fa fa-check"></i><b>10.1</b> Community typing</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="community-typing.html"><a href="community-typing.html#dirichlet-multinomial-mixtures-dmm"><i class="fa fa-check"></i><b>10.1.1</b> Dirichlet Multinomial Mixtures (DMM)</a></li>
<li class="chapter" data-level="10.1.2" data-path="community-typing.html"><a href="community-typing.html#pcoa-for-asv-level-data-with-bray-curtis-with-dmm-clusters-shown-with-colors"><i class="fa fa-check"></i><b>10.1.2</b> PCoA for ASV-level data with Bray-Curtis; with DMM clusters shown with colors</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="community-typing.html"><a href="community-typing.html#community-detection"><i class="fa fa-check"></i><b>10.2</b> Community Detection</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="differential-abundance.html"><a href="differential-abundance.html"><i class="fa fa-check"></i><b>11</b> Differential Abundance</a>
<ul>
<li class="chapter" data-level="11.1" data-path="differential-abundance.html"><a href="differential-abundance.html#introduction-to-differential-abundance-analysis"><i class="fa fa-check"></i><b>11.1</b> Introduction to differential abundance analysis</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="differential-abundance.html"><a href="differential-abundance.html#prevalence-filtering"><i class="fa fa-check"></i><b>11.1.1</b> Prevalence Filtering</a></li>
<li class="chapter" data-level="11.1.2" data-path="differential-abundance.html"><a href="differential-abundance.html#aldex2"><i class="fa fa-check"></i><b>11.1.2</b> ALDEx2</a></li>
<li class="chapter" data-level="11.1.3" data-path="differential-abundance.html"><a href="differential-abundance.html#ancom-bc"><i class="fa fa-check"></i><b>11.1.3</b> ANCOM-BC</a></li>
<li class="chapter" data-level="11.1.4" data-path="differential-abundance.html"><a href="differential-abundance.html#maaslin2"><i class="fa fa-check"></i><b>11.1.4</b> MaAsLin2</a></li>
<li class="chapter" data-level="11.1.5" data-path="differential-abundance.html"><a href="differential-abundance.html#comparison-of-the-methods"><i class="fa fa-check"></i><b>11.1.5</b> Comparison of the methods</a></li>
<li class="chapter" data-level="11.1.6" data-path="differential-abundance.html"><a href="differential-abundance.html#confounding-variables"><i class="fa fa-check"></i><b>11.1.6</b> Confounding variables</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="differential-abundance.html"><a href="differential-abundance.html#tree-based-methods"><i class="fa fa-check"></i><b>11.2</b> Tree-based methods</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="differential-abundance.html"><a href="differential-abundance.html#group-wise-associations-testing-based-on-balances-with-fido"><i class="fa fa-check"></i><b>11.2.1</b> Group-wise associations testing based on balances with fido</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="differential-abundance.html"><a href="differential-abundance.html#session-info-6"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="multitable.html"><a href="multitable.html"><i class="fa fa-check"></i><b>12</b> Representation of Multiple Data Tables</a>
<ul>
<li class="chapter" data-level="12.1" data-path="multitable.html"><a href="multitable.html#assay-data"><i class="fa fa-check"></i><b>12.1</b> Assay data</a></li>
<li class="chapter" data-level="12.2" data-path="multitable.html"><a href="multitable.html#alternative-experiments"><i class="fa fa-check"></i><b>12.2</b> Alternative experiments</a></li>
<li class="chapter" data-level="12.3" data-path="multitable.html"><a href="multitable.html#multiassayexperiments"><i class="fa fa-check"></i><b>12.3</b> MultiAssayExperiments</a></li>
<li class="chapter" data-level="" data-path="multitable.html"><a href="multitable.html#session-info-7"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="part"><span><b>III Appendix</b></span></li>
<li class="chapter" data-level="13" data-path="example-data.html"><a href="example-data.html"><i class="fa fa-check"></i><b>13</b> Example Data</a>
<ul>
<li class="chapter" data-level="13.1" data-path="example-data.html"><a href="example-data.html#package-data"><i class="fa fa-check"></i><b>13.1</b> Package data</a></li>
<li class="chapter" data-level="13.2" data-path="example-data.html"><a href="example-data.html#experimenthub-data"><i class="fa fa-check"></i><b>13.2</b> ExperimentHub data</a></li>
<li class="chapter" data-level="13.3" data-path="example-data.html"><a href="example-data.html#other-data-sources"><i class="fa fa-check"></i><b>13.3</b> Other data sources</a></li>
<li class="chapter" data-level="" data-path="example-data.html"><a href="example-data.html#session-info-8"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="function-ref.html"><a href="function-ref.html"><i class="fa fa-check"></i><b>14</b> Function Reference</a>
<ul>
<li class="chapter" data-level="14.1" data-path="function-ref.html"><a href="function-ref.html#objects"><i class="fa fa-check"></i><b>14.1</b> Objects</a></li>
<li class="chapter" data-level="14.2" data-path="function-ref.html"><a href="function-ref.html#reduced-dimension-pca-t-sne-umap-mds-etc"><i class="fa fa-check"></i><b>14.2</b> Reduced dimension (PCA, t-SNE, UMAP, MDS, etc)</a></li>
<li class="chapter" data-level="14.3" data-path="function-ref.html"><a href="function-ref.html#plotting"><i class="fa fa-check"></i><b>14.3</b> Plotting</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="extras.html"><a href="extras.html"><i class="fa fa-check"></i><b>15</b> Extras</a>
<ul>
<li class="chapter" data-level="15.1" data-path="extras.html"><a href="extras.html#interactive-3d-plots"><i class="fa fa-check"></i><b>15.1</b> Interactive 3D Plots</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="bibliography.html"><a href="bibliography.html"><i class="fa fa-check"></i>Bibliography</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Orchestrating Microbiome Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="differential-abundance" class="section level1" number="11">
<h1><span class="header-section-number">Chapter 11</span> Differential Abundance</h1>
<script>
document.addEventListener("click", function (event) {
    if (event.target.classList.contains("rebook-collapse")) {
        event.target.classList.toggle("active");
        var content = event.target.nextElementSibling;
        if (content.style.display === "block") {
            content.style.display = "none";
        } else {
            content.style.display = "block";
        }
    }
})
</script>
<style>
.rebook-collapse {
  background-color: #eee;
  color: #444;
  cursor: pointer;
  padding: 18px;
  width: 100%;
  border: none;
  text-align: left;
  outline: none;
  font-size: 15px;
}

.rebook-content {
  padding: 0 18px;
  display: none;
  overflow: hidden;
  background-color: #f1f1f1;
}
</style>
<div id="introduction-to-differential-abundance-analysis" class="section level2" number="11.1">
<h2><span class="header-section-number">11.1</span> Introduction to differential abundance analysis</h2>
<p><em>What is differential abundance analysis (DAA) and why do we do it?</em></p>
<p>In this section we will work with one of the
<a href="https://microbiome.github.io/mia/reference/mia-datasets.html">openly available datasets</a> in mia to illustrate how to perform differential abundance
analysis (DAA). DAA aims to identify differences in taxon abundance between two
or more groups (e.g. treatment vs control) for each taxon of a sample. This can
be performed at any phylogenetic level but we will work at Genus level
abundances in this section. We perform DAA to identify biomarkers and/or gain
understanding of a complex system by looking at its isolated components. For
example, identifying that a bacterial taxon is different between e.g. a patient
group with disease <em>X</em> vs a healthy control group might lead to important
insights into the pathophysiology. Changes in the microbiota might be causal or
a consequence of the disease. Either way, it can help to understand the system
as a whole. Be aware that this approach has also been criticized
<a href="https://arxiv.org/abs/2104.07266">recently</a>.</p>
<p><em>How to do DAA</em></p>
<p>There are many tools to perform DAA. The most popular tools, without going into
evaluating whether or not they perform well for this task, are:<br />
- <a href="https://bioconductor.org/packages/release/bioc/html/ALDEx2.html">ALDEx2</a><br />
- <a href="https://bioconductor.org/packages/release/bioc/html/ANCOMBC.html">ANCOM-BC</a><br />
- <a href="https://cran.r-project.org/web/packages/corncob/index.html">corncob</a><br />
- <a href="https://bioconductor.org/packages/release/bioc/html/DESeq2.html">DESeq2</a><br />
- <a href="https://bioconductor.org/packages/release/bioc/html/edgeR.html">edgeR</a><br />
- <a href="https://bioconductor.org/packages/release/bioc/html/lefser.html">LEFse</a><br />
- <a href="https://www.bioconductor.org/packages/release/bioc/html/Maaslin2.html">MaAsLin2</a><br />
- <a href="https://www.bioconductor.org/packages/release/bioc/html/metagenomeSeq.html">metagenomeSeq</a><br />
- <a href="https://bioconductor.org/packages/release/bioc/html/limma.html">limma voom</a><br />
- <a href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/t.test">t-test</a><br />
- <a href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/wilcox.test">Wilcoxon test</a></p>
<p>We recommend you to have a look at
<a href="https://www.biorxiv.org/content/10.1101/2021.05.10.443486v1.full">Nearing et al. (2021)</a> who compared all these listed methods across 38
different datasets. Because different methods have different approaches
(parametric vs non-parametric, different normalization techiniques etc.) to
perform the same task (test differential abundance), results can differ between
methods. Unfortunately, as Nearing et al. (2021) point out, they differ disturbingly
much. Therefore, it is highly recommended to pick several methods to get an
idea about how robust and potentially reproducible your findings are depending
on the method. In this section we demonstrate 3 methods that can be recommended
based on this recent review (ANCOM-BC, ALDEx2 and Maaslin2) and we will compare
the results between them.
Note that the purpose of this section is to show how to perform DAA in R, not
how to correctly do causal inference. E.g. there might be confounding factors
that might drive (the absence of) differences between the shown groups that we
ignore for simplicity. However, we will show how you could include covariates
in those models. Furthermore, we picked a dataset that merely has
microbial abundances in a TSE object as well as a grouping variable in the
sample data. We simplify the analysis by only including 2 of the 3 groups.</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="differential-abundance.html#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mia)</span>
<span id="cb232-2"><a href="differential-abundance.html#cb232-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb232-3"><a href="differential-abundance.html#cb232-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidySummarizedExperiment)</span>
<span id="cb232-4"><a href="differential-abundance.html#cb232-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ANCOMBC)</span>
<span id="cb232-5"><a href="differential-abundance.html#cb232-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ALDEx2)</span>
<span id="cb232-6"><a href="differential-abundance.html#cb232-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Maaslin2)</span>
<span id="cb232-7"><a href="differential-abundance.html#cb232-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb232-8"><a href="differential-abundance.html#cb232-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb232-9"><a href="differential-abundance.html#cb232-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-10"><a href="differential-abundance.html#cb232-10" aria-hidden="true" tabindex="-1"></a><span class="co"># we use the dmn_se dataset and restrict it to </span></span>
<span id="cb232-11"><a href="differential-abundance.html#cb232-11" aria-hidden="true" tabindex="-1"></a><span class="co"># obese vs lean for easy illustration</span></span>
<span id="cb232-12"><a href="differential-abundance.html#cb232-12" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(dmn_se)</span>
<span id="cb232-13"><a href="differential-abundance.html#cb232-13" aria-hidden="true" tabindex="-1"></a>tse <span class="ot">&lt;-</span> dmn_se</span>
<span id="cb232-14"><a href="differential-abundance.html#cb232-14" aria-hidden="true" tabindex="-1"></a>tse <span class="ot">&lt;-</span> tse[ ,<span class="fu">colData</span>(tse)<span class="sc">$</span>pheno <span class="sc">!=</span> <span class="st">&quot;Overwt&quot;</span>]</span>
<span id="cb232-15"><a href="differential-abundance.html#cb232-15" aria-hidden="true" tabindex="-1"></a><span class="fu">colData</span>(tse)<span class="sc">$</span>pheno <span class="ot">&lt;-</span> <span class="fu">fct_drop</span>(<span class="fu">colData</span>(tse)<span class="sc">$</span>pheno, <span class="st">&quot;Overwt&quot;</span>)</span>
<span id="cb232-16"><a href="differential-abundance.html#cb232-16" aria-hidden="true" tabindex="-1"></a><span class="co"># how many observations do we have per group?</span></span>
<span id="cb232-17"><a href="differential-abundance.html#cb232-17" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(<span class="fu">as.data.frame</span>(<span class="fu">colData</span>(tse)), pheno) <span class="sc">%&gt;%</span> <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">pheno</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Lean</td>
<td align="right">61</td>
</tr>
<tr class="even">
<td align="left">Obese</td>
<td align="right">193</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="differential-abundance.html#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set a seed because some tools can randomly vary and then produce </span></span>
<span id="cb233-2"><a href="differential-abundance.html#cb233-2" aria-hidden="true" tabindex="-1"></a><span class="co"># different results:</span></span>
<span id="cb233-3"><a href="differential-abundance.html#cb233-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span></code></pre></div>
<div id="prevalence-filtering" class="section level3" number="11.1.1">
<h3><span class="header-section-number">11.1.1</span> Prevalence Filtering</h3>
<p>Before we jump to our analyses, we may want to perform prevalence filtering.
Nearing et al. (2021) found that applying a 10% threshold for the prevalence of
the taxa generally resulted in more robust results. Some tools have builtin
arguments for that. By applying the threshold to our input data, we can make
sure it is applied for all tools. Below we show how to do this in <code>mia</code>:</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="differential-abundance.html#cb234-1" aria-hidden="true" tabindex="-1"></a>tse <span class="ot">&lt;-</span> <span class="fu">subsetByPrevalentTaxa</span>(tse, <span class="at">detection =</span> <span class="dv">0</span>, <span class="at">prevalence =</span> <span class="fl">0.1</span>)</span></code></pre></div>
</div>
<div id="aldex2" class="section level3" number="11.1.2">
<h3><span class="header-section-number">11.1.2</span> ALDEx2</h3>
<p>In this section, we will show how to perform a simple ALDEx2 analysis. If you
would choose to pick a single method, this method could be recommended to use.
According to the developers experience, it tends to identify the common
features identified by other methods. This statement is in line with a recent
independent evaluation by Nearing et al. (2021). Please also have a look at
the more extensive <a href="https://bioconductor.org/packages/release/bioc/vignettes/ALDEx2/inst/doc/ALDEx2_vignette.html">vignette</a>
that covers this flexible tool in more depth. ALDEx2 estimates technical
variation within each sample per taxon by utilizing the Dirichlet distribution.
It furthermore applies the centered-log-ratio transformation (or closely
related log-ratio transforms). Depending on the experimental setup, it will
perform a two sample Welch’s T-test and Wilcoxon-test or a one-way ANOVA and
Kruskal-Wallis-test. For more complex study designs, there is a possibility to
utilize the <code>glm</code> functionality within ALDEx2. The Benjamini-Hochberg procedure
is applied in any case to correct for multiple testing. Below we show a simple
example that illustrates the workflow.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="differential-abundance.html#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate Monte Carlo samples of the Dirichlet distribution for each sample.</span></span>
<span id="cb235-2"><a href="differential-abundance.html#cb235-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert each instance using the centred log-ratio transform.</span></span>
<span id="cb235-3"><a href="differential-abundance.html#cb235-3" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the input for all further analyses.</span></span>
<span id="cb235-4"><a href="differential-abundance.html#cb235-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">aldex.clr</span>(</span>
<span id="cb235-5"><a href="differential-abundance.html#cb235-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">reads =</span> <span class="fu">assay</span>(tse),</span>
<span id="cb235-6"><a href="differential-abundance.html#cb235-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">conds =</span> <span class="fu">colData</span>(tse)<span class="sc">$</span>pheno, </span>
<span id="cb235-7"><a href="differential-abundance.html#cb235-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 128 recommened for ttest, 1000 for rigorous effect size calculation</span></span>
<span id="cb235-8"><a href="differential-abundance.html#cb235-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">mc.samples =</span> <span class="dv">128</span>, </span>
<span id="cb235-9"><a href="differential-abundance.html#cb235-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">denom =</span> <span class="st">&quot;all&quot;</span>,</span>
<span id="cb235-10"><a href="differential-abundance.html#cb235-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb235-11"><a href="differential-abundance.html#cb235-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb235-12"><a href="differential-abundance.html#cb235-12" aria-hidden="true" tabindex="-1"></a><span class="co"># calculates expected values of the Welch&#39;s t-test and Wilcoxon rank test on</span></span>
<span id="cb235-13"><a href="differential-abundance.html#cb235-13" aria-hidden="true" tabindex="-1"></a><span class="co"># the data returned by aldex.clr</span></span>
<span id="cb235-14"><a href="differential-abundance.html#cb235-14" aria-hidden="true" tabindex="-1"></a>x_tt <span class="ot">&lt;-</span> <span class="fu">aldex.ttest</span>(</span>
<span id="cb235-15"><a href="differential-abundance.html#cb235-15" aria-hidden="true" tabindex="-1"></a>  x, </span>
<span id="cb235-16"><a href="differential-abundance.html#cb235-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">paired.test =</span> <span class="cn">FALSE</span>, </span>
<span id="cb235-17"><a href="differential-abundance.html#cb235-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb235-18"><a href="differential-abundance.html#cb235-18" aria-hidden="true" tabindex="-1"></a><span class="co"># determines the median clr abundance of the feature in all samples and in</span></span>
<span id="cb235-19"><a href="differential-abundance.html#cb235-19" aria-hidden="true" tabindex="-1"></a><span class="co"># groups, the median difference between the two groups, the median variation</span></span>
<span id="cb235-20"><a href="differential-abundance.html#cb235-20" aria-hidden="true" tabindex="-1"></a><span class="co"># within each group and the effect size, which is the median of the ratio</span></span>
<span id="cb235-21"><a href="differential-abundance.html#cb235-21" aria-hidden="true" tabindex="-1"></a><span class="co"># of the between group difference and the larger of the variance within groups</span></span>
<span id="cb235-22"><a href="differential-abundance.html#cb235-22" aria-hidden="true" tabindex="-1"></a>x_effect <span class="ot">&lt;-</span> <span class="fu">aldex.effect</span>(x, <span class="at">CI =</span> <span class="cn">TRUE</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb235-23"><a href="differential-abundance.html#cb235-23" aria-hidden="true" tabindex="-1"></a><span class="co"># combine all outputs </span></span>
<span id="cb235-24"><a href="differential-abundance.html#cb235-24" aria-hidden="true" tabindex="-1"></a>aldex_out <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x_tt, x_effect)</span></code></pre></div>
<p>Now, we can create a so called Bland-Altman or MA plot (left). It shows the
association between the relative abundance and the magnitude of the difference
per sample. Next to that, we can also create a plot that shows the dispersion
on the x-axis instead of log-ratio abundance. Red dots represent genera that are
differentially abundant (<span class="math inline">\(q \leq 0.1\)</span>) between the 2 groups. Black points are
rare taxa and grey ones are abundant taxa.</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="differential-abundance.html#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb236-2"><a href="differential-abundance.html#cb236-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aldex.plot</span>(</span>
<span id="cb236-3"><a href="differential-abundance.html#cb236-3" aria-hidden="true" tabindex="-1"></a>    aldex_out, </span>
<span id="cb236-4"><a href="differential-abundance.html#cb236-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">&quot;MA&quot;</span>, </span>
<span id="cb236-5"><a href="differential-abundance.html#cb236-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">test =</span> <span class="st">&quot;welch&quot;</span>, </span>
<span id="cb236-6"><a href="differential-abundance.html#cb236-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">&quot;Log-ratio abundance&quot;</span>,</span>
<span id="cb236-7"><a href="differential-abundance.html#cb236-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">&quot;Difference&quot;</span>,</span>
<span id="cb236-8"><a href="differential-abundance.html#cb236-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">cutoff =</span> <span class="fl">0.05</span></span>
<span id="cb236-9"><a href="differential-abundance.html#cb236-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb236-10"><a href="differential-abundance.html#cb236-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aldex.plot</span>(</span>
<span id="cb236-11"><a href="differential-abundance.html#cb236-11" aria-hidden="true" tabindex="-1"></a>    aldex_out, </span>
<span id="cb236-12"><a href="differential-abundance.html#cb236-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">&quot;MW&quot;</span>, </span>
<span id="cb236-13"><a href="differential-abundance.html#cb236-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">test =</span> <span class="st">&quot;welch&quot;</span>,</span>
<span id="cb236-14"><a href="differential-abundance.html#cb236-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">&quot;Dispersion&quot;</span>,</span>
<span id="cb236-15"><a href="differential-abundance.html#cb236-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">&quot;Difference&quot;</span>,</span>
<span id="cb236-16"><a href="differential-abundance.html#cb236-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">cutoff =</span> <span class="fl">0.05</span></span>
<span id="cb236-17"><a href="differential-abundance.html#cb236-17" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="30_differential_abundance_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>The evaluation as differential abundant in above plots is based on the
corrected pvalue. According to the ALDEx2 developers, the safest approach is to
identify those features where the 95% CI of the
effect size does not cross 0. As we can see in below table, this is not the
case for any of the identified
genera (see overlap column, which indicates the proportion of overlap). Also,
the authors recommend an effect
size cutoff of 1 rather than only interpreting the pvalue. Again, this is not
the case for any feature.</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="differential-abundance.html#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames_to_column</span>(aldex_out, <span class="st">&quot;genus&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb237-2"><a href="differential-abundance.html#cb237-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(wi.eBH <span class="sc">&lt;=</span> <span class="fl">0.05</span>)  <span class="sc">%&gt;%</span> <span class="co"># here we chose the wilcoxon output rather than tt</span></span>
<span id="cb237-3"><a href="differential-abundance.html#cb237-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(genus, we.eBH, wi.eBH, effect, overlap) <span class="sc">%&gt;%</span></span>
<span id="cb237-4"><a href="differential-abundance.html#cb237-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">genus</th>
<th align="right">we.eBH</th>
<th align="right">wi.eBH</th>
<th align="right">effect</th>
<th align="right">overlap</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Alistipes</td>
<td align="right">0.0009</td>
<td align="right">0.0001</td>
<td align="right">-0.3823</td>
<td align="right">0.2979</td>
</tr>
<tr class="even">
<td align="left">Barnesiella</td>
<td align="right">0.0442</td>
<td align="right">0.0066</td>
<td align="right">-0.3229</td>
<td align="right">0.3489</td>
</tr>
<tr class="odd">
<td align="left">Catenibacterium</td>
<td align="right">0.0266</td>
<td align="right">0.0330</td>
<td align="right">0.2713</td>
<td align="right">0.3718</td>
</tr>
<tr class="even">
<td align="left">Lactobacillus</td>
<td align="right">0.0282</td>
<td align="right">0.0183</td>
<td align="right">0.2983</td>
<td align="right">0.3537</td>
</tr>
<tr class="odd">
<td align="left">Megasphaera</td>
<td align="right">0.0000</td>
<td align="right">0.0001</td>
<td align="right">0.5249</td>
<td align="right">0.2758</td>
</tr>
<tr class="even">
<td align="left">Oscillibacter</td>
<td align="right">0.0004</td>
<td align="right">0.0014</td>
<td align="right">-0.3681</td>
<td align="right">0.3291</td>
</tr>
<tr class="odd">
<td align="left">Parabacteroides</td>
<td align="right">0.0541</td>
<td align="right">0.0133</td>
<td align="right">-0.2832</td>
<td align="right">0.3509</td>
</tr>
<tr class="even">
<td align="left">Phascolarctobacterium</td>
<td align="right">0.0238</td>
<td align="right">0.0077</td>
<td align="right">-0.3491</td>
<td align="right">0.3404</td>
</tr>
<tr class="odd">
<td align="left">Uknown</td>
<td align="right">0.0786</td>
<td align="right">0.0439</td>
<td align="right">-0.2474</td>
<td align="right">0.3852</td>
</tr>
</tbody>
</table>
</div>
<div id="ancom-bc" class="section level3" number="11.1.3">
<h3><span class="header-section-number">11.1.3</span> ANCOM-BC</h3>
<p><a href="https://www.nature.com/articles/s41467-020-17041-7">The analysis of composition of microbiomes with bias correction
(ANCOM-BC)</a>
is a recently developed method for differential abundance testing. It is based
on an
<a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4450248/">earlier published approach</a>.
The previous version of ANCOM was among the methods that produced the
<a href="https://www.biorxiv.org/content/10.1101/2021.05.10.443486v1.full">most consistent results and is probably a conservative approach</a>.
However, the new ANCOM-BC method operates quite differently compared to the
former ANCOM method.</p>
<p>As the only method, ANCOM-BC incorporates the so called <em>sampling fraction</em>
into the model. The latter term could be empirically estimated by the ratio of
the library size to the microbial load. According to the authors, variations in
this sampling fraction would bias differential abundance analyses if ignored.
Furthermore, this method provides p-values, and confidence intervals for each
taxon. It also controls the FDR and it is computationally simple to implement.</p>
<p>As we will see below, to obtain results, all that is needed is to pass
a phyloseq object to the <code>ancombc()</code> function. Therefore, below we first
convert our <code>tse</code> object to a <code>phyloseq</code> object. Then, we specify the formula.
In this formula, other covariates could potentially be included to adjust for
confounding. We show this further below.
Please check the <a href="https://rdrr.io/github/FrederickHuangLin/ANCOMBC/man/ancombc.html">function documentation</a>
to learn about the additional arguments that we specify below.</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="differential-abundance.html#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="co"># currently, ancombc requires the phyloseq format, but we can easily convert:</span></span>
<span id="cb238-2"><a href="differential-abundance.html#cb238-2" aria-hidden="true" tabindex="-1"></a>pseq <span class="ot">&lt;-</span> <span class="fu">makePhyloseqFromTreeSummarizedExperiment</span>(tse)</span>
<span id="cb238-3"><a href="differential-abundance.html#cb238-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-4"><a href="differential-abundance.html#cb238-4" aria-hidden="true" tabindex="-1"></a><span class="co"># perform the analysis </span></span>
<span id="cb238-5"><a href="differential-abundance.html#cb238-5" aria-hidden="true" tabindex="-1"></a>out <span class="ot">=</span> <span class="fu">ancombc</span>(</span>
<span id="cb238-6"><a href="differential-abundance.html#cb238-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">phyloseq =</span> pseq, </span>
<span id="cb238-7"><a href="differential-abundance.html#cb238-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> <span class="st">&quot;pheno&quot;</span>, </span>
<span id="cb238-8"><a href="differential-abundance.html#cb238-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">p_adj_method =</span> <span class="st">&quot;fdr&quot;</span>, </span>
<span id="cb238-9"><a href="differential-abundance.html#cb238-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">zero_cut =</span> <span class="dv">1</span>, <span class="co"># no prev filtering necessary anymore </span></span>
<span id="cb238-10"><a href="differential-abundance.html#cb238-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">lib_cut =</span> <span class="dv">0</span>, </span>
<span id="cb238-11"><a href="differential-abundance.html#cb238-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">&quot;pheno&quot;</span>, </span>
<span id="cb238-12"><a href="differential-abundance.html#cb238-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">struc_zero =</span> <span class="cn">TRUE</span>, </span>
<span id="cb238-13"><a href="differential-abundance.html#cb238-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">neg_lb =</span> <span class="cn">TRUE</span>, </span>
<span id="cb238-14"><a href="differential-abundance.html#cb238-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">tol =</span> <span class="fl">1e-5</span>, </span>
<span id="cb238-15"><a href="differential-abundance.html#cb238-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_iter =</span> <span class="dv">100</span>, </span>
<span id="cb238-16"><a href="differential-abundance.html#cb238-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">conserve =</span> <span class="cn">TRUE</span>, </span>
<span id="cb238-17"><a href="differential-abundance.html#cb238-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="fl">0.05</span>, </span>
<span id="cb238-18"><a href="differential-abundance.html#cb238-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">global =</span> <span class="cn">TRUE</span></span>
<span id="cb238-19"><a href="differential-abundance.html#cb238-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb238-20"><a href="differential-abundance.html#cb238-20" aria-hidden="true" tabindex="-1"></a><span class="co"># store the results in res </span></span>
<span id="cb238-21"><a href="differential-abundance.html#cb238-21" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> out<span class="sc">$</span>res</span></code></pre></div>
<p>The object <code>out</code> contains all model output. Again, see the
<a href="https://rdrr.io/github/FrederickHuangLin/ANCOMBC/man/ancombc.html">documentation of the function</a>
under <strong>Value</strong> for an explanation of all the output objects. Our question
whether taxa are differentially abundant can be answered by looking at the
<code>res</code> object, which now contains dataframes with the coefficients,
standard errors, p-values and q-values. Conveniently, there is a dataframe
<code>diff_abn</code>. Here, for each taxon it is indicated whether it is differentially
abundant between the groups. Below we show the first 6 entries of this
dataframe:</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="differential-abundance.html#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(res<span class="sc">$</span>diff_abn))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">phenoObese</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Acetanaerobacterium</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">Acetivibrio</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">Acidaminococcus</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">Akkermansia</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">Alistipes</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">Allisonella</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
</div>
<div id="maaslin2" class="section level3" number="11.1.4">
<h3><span class="header-section-number">11.1.4</span> MaAsLin2</h3>
<p>Lastly, we will illustrate how to use MaAsLin2, which is the next generation of
MaAsLin. As it is based on generalized linear models, it is flexible for different study designs and covariate
structures. The official package tutorial can be found <a href="https://github.com/biobakery/biobakery/wiki/maaslin2">here</a>.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="differential-abundance.html#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="co"># maaslin expects features as columns and samples as rows </span></span>
<span id="cb240-2"><a href="differential-abundance.html#cb240-2" aria-hidden="true" tabindex="-1"></a><span class="co"># for both the asv/otu table as well as meta data </span></span>
<span id="cb240-3"><a href="differential-abundance.html#cb240-3" aria-hidden="true" tabindex="-1"></a>asv <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">assay</span>(tse))</span>
<span id="cb240-4"><a href="differential-abundance.html#cb240-4" aria-hidden="true" tabindex="-1"></a>meta_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">colData</span>(tse))</span>
<span id="cb240-5"><a href="differential-abundance.html#cb240-5" aria-hidden="true" tabindex="-1"></a><span class="co"># you can specifiy different GLMs/normalizations/transforms. We used similar</span></span>
<span id="cb240-6"><a href="differential-abundance.html#cb240-6" aria-hidden="true" tabindex="-1"></a><span class="co"># settings as in Nearing et al. (2021) here:</span></span>
<span id="cb240-7"><a href="differential-abundance.html#cb240-7" aria-hidden="true" tabindex="-1"></a>fit_data <span class="ot">&lt;-</span> <span class="fu">Maaslin2</span>(</span>
<span id="cb240-8"><a href="differential-abundance.html#cb240-8" aria-hidden="true" tabindex="-1"></a>  asv,</span>
<span id="cb240-9"><a href="differential-abundance.html#cb240-9" aria-hidden="true" tabindex="-1"></a>  meta_data,</span>
<span id="cb240-10"><a href="differential-abundance.html#cb240-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">output =</span> <span class="st">&quot;DAA example&quot;</span>,</span>
<span id="cb240-11"><a href="differential-abundance.html#cb240-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">transform =</span> <span class="st">&quot;AST&quot;</span>,</span>
<span id="cb240-12"><a href="differential-abundance.html#cb240-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed_effects =</span> <span class="st">&quot;pheno&quot;</span>,</span>
<span id="cb240-13"><a href="differential-abundance.html#cb240-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># random_effects = c(...), # you can also fit MLM by specifying random effects</span></span>
<span id="cb240-14"><a href="differential-abundance.html#cb240-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># specifying a ref is especially important if you have more than 2 levels</span></span>
<span id="cb240-15"><a href="differential-abundance.html#cb240-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">reference =</span> <span class="st">&quot;pheno,Lean&quot;</span>,  </span>
<span id="cb240-16"><a href="differential-abundance.html#cb240-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">normalization =</span> <span class="st">&quot;TSS&quot;</span>,</span>
<span id="cb240-17"><a href="differential-abundance.html#cb240-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">standardize =</span> <span class="cn">FALSE</span>,</span>
<span id="cb240-18"><a href="differential-abundance.html#cb240-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_prevalence =</span> <span class="dv">0</span> <span class="co"># prev filterin already done</span></span>
<span id="cb240-19"><a href="differential-abundance.html#cb240-19" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="differential-abundance.html#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="co"># which genera are identified as differentially abundant? (leave out &quot;head&quot; to</span></span>
<span id="cb241-2"><a href="differential-abundance.html#cb241-2" aria-hidden="true" tabindex="-1"></a><span class="co"># see all)</span></span>
<span id="cb241-3"><a href="differential-abundance.html#cb241-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(<span class="fu">filter</span>(fit_data<span class="sc">$</span>results, qval <span class="sc">&lt;=</span> <span class="fl">0.05</span>)))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">feature</th>
<th align="left">metadata</th>
<th align="left">value</th>
<th align="right">coef</th>
<th align="right">stderr</th>
<th align="right">pval</th>
<th align="left">name</th>
<th align="right">qval</th>
<th align="right">N</th>
<th align="right">N.not.zero</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Megasphaera</td>
<td align="left">pheno</td>
<td align="left">Obese</td>
<td align="right">0.0489</td>
<td align="right">0.0093</td>
<td align="right">0</td>
<td align="left">phenoObese</td>
<td align="right">0e+00</td>
<td align="right">254</td>
<td align="right">78</td>
</tr>
<tr class="even">
<td align="left">Barnesiella</td>
<td align="left">pheno</td>
<td align="left">Obese</td>
<td align="right">-0.0297</td>
<td align="right">0.0068</td>
<td align="right">0</td>
<td align="left">phenoObese</td>
<td align="right">2e-04</td>
<td align="right">254</td>
<td align="right">111</td>
</tr>
<tr class="odd">
<td align="left">Parabacteroides</td>
<td align="left">pheno</td>
<td align="left">Obese</td>
<td align="right">-0.0219</td>
<td align="right">0.0050</td>
<td align="right">0</td>
<td align="left">phenoObese</td>
<td align="right">2e-04</td>
<td align="right">254</td>
<td align="right">163</td>
</tr>
<tr class="even">
<td align="left">Phascolarctobacterium</td>
<td align="left">pheno</td>
<td align="left">Obese</td>
<td align="right">-0.0325</td>
<td align="right">0.0072</td>
<td align="right">0</td>
<td align="left">phenoObese</td>
<td align="right">2e-04</td>
<td align="right">254</td>
<td align="right">99</td>
</tr>
<tr class="odd">
<td align="left">Alistipes</td>
<td align="left">pheno</td>
<td align="left">Obese</td>
<td align="right">-0.0523</td>
<td align="right">0.0123</td>
<td align="right">0</td>
<td align="left">phenoObese</td>
<td align="right">3e-04</td>
<td align="right">254</td>
<td align="right">227</td>
</tr>
<tr class="even">
<td align="left">Desulfovibrio</td>
<td align="left">pheno</td>
<td align="left">Obese</td>
<td align="right">-0.0134</td>
<td align="right">0.0032</td>
<td align="right">0</td>
<td align="left">phenoObese</td>
<td align="right">3e-04</td>
<td align="right">254</td>
<td align="right">72</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="differential-abundance.html#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A folder will be created that is called like the above specified output.</span></span>
<span id="cb242-2"><a href="differential-abundance.html#cb242-2" aria-hidden="true" tabindex="-1"></a><span class="co"># It contains also figures to visualize the difference between genera </span></span>
<span id="cb242-3"><a href="differential-abundance.html#cb242-3" aria-hidden="true" tabindex="-1"></a><span class="co"># for the significant ones.</span></span></code></pre></div>
</div>
<div id="comparison-of-the-methods" class="section level3" number="11.1.5">
<h3><span class="header-section-number">11.1.5</span> Comparison of the methods</h3>
<p>When we compare the methods in the context of a research question, we could
look at e.g. at whether they agree based on the applied decision criterion
(e.g. adjusted p value &lt; 0.05). That is what we illustrate here. First we will
look at how many taxa were identified by each method to begin with. In the next
step we will look at the intersection of identified taxa. To achieve that, we
first create a dataframe that summarises the decision criterion for each method
and shows a score from 0 to 3 indicating how many methods agreed on a particular
taxon.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="differential-abundance.html#cb243-1" aria-hidden="true" tabindex="-1"></a>summ <span class="ot">&lt;-</span> <span class="fu">full_join</span>(</span>
<span id="cb243-2"><a href="differential-abundance.html#cb243-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(aldex_out, <span class="st">&quot;genus&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb243-3"><a href="differential-abundance.html#cb243-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(genus, <span class="at">aldex2 =</span> wi.eBH),</span>
<span id="cb243-4"><a href="differential-abundance.html#cb243-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(out<span class="sc">$</span>res<span class="sc">$</span>diff_abn, <span class="st">&quot;genus&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb243-5"><a href="differential-abundance.html#cb243-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(genus, <span class="at">ancombc =</span> phenoObese),</span>
<span id="cb243-6"><a href="differential-abundance.html#cb243-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">&quot;genus&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb243-7"><a href="differential-abundance.html#cb243-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(</span>
<span id="cb243-8"><a href="differential-abundance.html#cb243-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(fit_data<span class="sc">$</span>results, <span class="at">genus =</span> feature, <span class="at">maaslin2 =</span> qval), </span>
<span id="cb243-9"><a href="differential-abundance.html#cb243-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">&quot;genus&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb243-10"><a href="differential-abundance.html#cb243-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb243-11"><a href="differential-abundance.html#cb243-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">c</span>(aldex2, maaslin2), <span class="sc">~</span> .x <span class="sc">&lt;=</span> <span class="fl">0.05</span>),</span>
<span id="cb243-12"><a href="differential-abundance.html#cb243-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the following line would be necessary without prevalence filtering </span></span>
<span id="cb243-13"><a href="differential-abundance.html#cb243-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># as some methods output NA</span></span>
<span id="cb243-14"><a href="differential-abundance.html#cb243-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">#across(-genus, function(x) ifelse(is.na(x), FALSE, x)),</span></span>
<span id="cb243-15"><a href="differential-abundance.html#cb243-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">score =</span> <span class="fu">rowSums</span>(<span class="fu">across</span>(<span class="fu">c</span>(aldex2, ancombc, maaslin2)))</span>
<span id="cb243-16"><a href="differential-abundance.html#cb243-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb243-17"><a href="differential-abundance.html#cb243-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-18"><a href="differential-abundance.html#cb243-18" aria-hidden="true" tabindex="-1"></a><span class="co"># This is how it looks like:</span></span>
<span id="cb243-19"><a href="differential-abundance.html#cb243-19" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(summ))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">genus</th>
<th align="left">aldex2</th>
<th align="left">ancombc</th>
<th align="left">maaslin2</th>
<th align="right">score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Acetanaerobacterium</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Acetivibrio</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Acidaminococcus</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Akkermansia</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Alistipes</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Allisonella</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>Now we can answer our questions:</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="differential-abundance.html#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="co"># how many genera were identified by each method?</span></span>
<span id="cb244-2"><a href="differential-abundance.html#cb244-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(summ, <span class="fu">across</span>(<span class="fu">where</span>(is.logical), sum)) <span class="sc">%&gt;%</span></span>
<span id="cb244-3"><a href="differential-abundance.html#cb244-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">aldex2</th>
<th align="right">ancombc</th>
<th align="right">maaslin2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">9</td>
<td align="right">22</td>
<td align="right">16</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="differential-abundance.html#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="co"># which genera are identified by all methods?</span></span>
<span id="cb245-2"><a href="differential-abundance.html#cb245-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(summ, score <span class="sc">==</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">genus</th>
<th align="left">aldex2</th>
<th align="left">ancombc</th>
<th align="left">maaslin2</th>
<th align="right">score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Alistipes</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Barnesiella</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">Catenibacterium</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Lactobacillus</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">Megasphaera</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Oscillibacter</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">Parabacteroides</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Phascolarctobacterium</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">3</td>
</tr>
</tbody>
</table>
<p>We see that each method identified at least 9 genera as differentially
abundant. Eight of those that were identified by ALDEx2,
were also identified by both of the other methods. We could plot the data for
any method or for those taxa that were identified by all methods:</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="differential-abundance.html#cb246-1" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(<span class="fu">assay</span>(tse)))</span>
<span id="cb246-2"><a href="differential-abundance.html#cb246-2" aria-hidden="true" tabindex="-1"></a>plot_data<span class="sc">$</span>pheno <span class="ot">&lt;-</span> <span class="fu">colData</span>(tse)<span class="sc">$</span>pheno</span>
<span id="cb246-3"><a href="differential-abundance.html#cb246-3" aria-hidden="true" tabindex="-1"></a><span class="co"># create a plot for each genus where the score is indicated in the title</span></span>
<span id="cb246-4"><a href="differential-abundance.html#cb246-4" aria-hidden="true" tabindex="-1"></a>plots <span class="ot">&lt;-</span> <span class="fu">pmap</span>(<span class="fu">select</span>(summ, genus, score), <span class="cf">function</span>(genus, score) {</span>
<span id="cb246-5"><a href="differential-abundance.html#cb246-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(plot_data, <span class="fu">aes_string</span>(<span class="st">&quot;pheno&quot;</span>, genus)) <span class="sc">+</span></span>
<span id="cb246-6"><a href="differential-abundance.html#cb246-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> pheno), <span class="at">outlier.shape =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb246-7"><a href="differential-abundance.html#cb246-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb246-8"><a href="differential-abundance.html#cb246-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">&quot;Robustness score {score}&quot;</span>)) <span class="sc">+</span></span>
<span id="cb246-9"><a href="differential-abundance.html#cb246-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb246-10"><a href="differential-abundance.html#cb246-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb246-11"><a href="differential-abundance.html#cb246-11" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb246-12"><a href="differential-abundance.html#cb246-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-13"><a href="differential-abundance.html#cb246-13" aria-hidden="true" tabindex="-1"></a><span class="co"># now we can show only those genera that have at least score 3 (or 2 or 1)</span></span>
<span id="cb246-14"><a href="differential-abundance.html#cb246-14" aria-hidden="true" tabindex="-1"></a>robust_plots <span class="ot">&lt;-</span> plots[summ<span class="sc">$</span>score <span class="sc">==</span> <span class="dv">3</span>] </span>
<span id="cb246-15"><a href="differential-abundance.html#cb246-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-16"><a href="differential-abundance.html#cb246-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-17"><a href="differential-abundance.html#cb246-17" aria-hidden="true" tabindex="-1"></a><span class="co"># to display this nicely in the book we use patchwork here:</span></span>
<span id="cb246-18"><a href="differential-abundance.html#cb246-18" aria-hidden="true" tabindex="-1"></a><span class="co"># (we show first 8)</span></span>
<span id="cb246-19"><a href="differential-abundance.html#cb246-19" aria-hidden="true" tabindex="-1"></a>robust_plots[[<span class="dv">1</span>]] <span class="sc">+</span> </span>
<span id="cb246-20"><a href="differential-abundance.html#cb246-20" aria-hidden="true" tabindex="-1"></a>  robust_plots[[<span class="dv">2</span>]] <span class="sc">+</span> </span>
<span id="cb246-21"><a href="differential-abundance.html#cb246-21" aria-hidden="true" tabindex="-1"></a>  robust_plots[[<span class="dv">3</span>]] <span class="sc">+</span> </span>
<span id="cb246-22"><a href="differential-abundance.html#cb246-22" aria-hidden="true" tabindex="-1"></a>  robust_plots[[<span class="dv">4</span>]] <span class="sc">+</span></span>
<span id="cb246-23"><a href="differential-abundance.html#cb246-23" aria-hidden="true" tabindex="-1"></a>  robust_plots[[<span class="dv">5</span>]] <span class="sc">+</span></span>
<span id="cb246-24"><a href="differential-abundance.html#cb246-24" aria-hidden="true" tabindex="-1"></a>  robust_plots[[<span class="dv">6</span>]] <span class="sc">+</span></span>
<span id="cb246-25"><a href="differential-abundance.html#cb246-25" aria-hidden="true" tabindex="-1"></a>  robust_plots[[<span class="dv">7</span>]] <span class="sc">+</span></span>
<span id="cb246-26"><a href="differential-abundance.html#cb246-26" aria-hidden="true" tabindex="-1"></a>  robust_plots[[<span class="dv">8</span>]] <span class="sc">+</span></span>
<span id="cb246-27"><a href="differential-abundance.html#cb246-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="30_differential_abundance_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="differential-abundance.html#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or if we have most trust in any specific method we can show genera that </span></span>
<span id="cb247-2"><a href="differential-abundance.html#cb247-2" aria-hidden="true" tabindex="-1"></a><span class="co"># are differentially abundant according to that method and then look in the</span></span>
<span id="cb247-3"><a href="differential-abundance.html#cb247-3" aria-hidden="true" tabindex="-1"></a><span class="co"># title how many methods also identified it (we only show first 6 here):</span></span>
<span id="cb247-4"><a href="differential-abundance.html#cb247-4" aria-hidden="true" tabindex="-1"></a>ancombc_plots <span class="ot">&lt;-</span> plots[summ<span class="sc">$</span>ancombc] </span>
<span id="cb247-5"><a href="differential-abundance.html#cb247-5" aria-hidden="true" tabindex="-1"></a>ancombc_plots[[<span class="dv">1</span>]] <span class="sc">+</span> </span>
<span id="cb247-6"><a href="differential-abundance.html#cb247-6" aria-hidden="true" tabindex="-1"></a>  ancombc_plots[[<span class="dv">2</span>]] <span class="sc">+</span> </span>
<span id="cb247-7"><a href="differential-abundance.html#cb247-7" aria-hidden="true" tabindex="-1"></a>  ancombc_plots[[<span class="dv">3</span>]] <span class="sc">+</span> </span>
<span id="cb247-8"><a href="differential-abundance.html#cb247-8" aria-hidden="true" tabindex="-1"></a>  ancombc_plots[[<span class="dv">4</span>]] <span class="sc">+</span></span>
<span id="cb247-9"><a href="differential-abundance.html#cb247-9" aria-hidden="true" tabindex="-1"></a>  ancombc_plots[[<span class="dv">5</span>]] <span class="sc">+</span></span>
<span id="cb247-10"><a href="differential-abundance.html#cb247-10" aria-hidden="true" tabindex="-1"></a>  ancombc_plots[[<span class="dv">6</span>]] </span></code></pre></div>
<p><img src="30_differential_abundance_files/figure-html/unnamed-chunk-11-2.png" width="672" /></p>
</div>
<div id="confounding-variables" class="section level3" number="11.1.6">
<h3><span class="header-section-number">11.1.6</span> Confounding variables</h3>
<p>To perform causal inference, it is crucial that the method is able to include
covariates in the model. This is not possible with e.g. the Wilcoxon test.
Other methods such as both ANCOM methods, ALDEx2, DESeq2, MaAsLin2 and others
allow this. Below we show how to include a covariate in ANCOM-BC.
It is very similar for all the methods that allow this. Since in this dataset
there are no covariates, I first simulate a new variable and add it to the TSE
object.</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="differential-abundance.html#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="co"># to join new data to existing colData we need to put rownames as a column </span></span>
<span id="cb248-2"><a href="differential-abundance.html#cb248-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colData</span>(tse)<span class="sc">$</span>sample_id <span class="ot">&lt;-</span> <span class="fu">rownames</span>(<span class="fu">colData</span>(tse))</span>
<span id="cb248-3"><a href="differential-abundance.html#cb248-3" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate a covariate that I will add to the colData.</span></span>
<span id="cb248-4"><a href="differential-abundance.html#cb248-4" aria-hidden="true" tabindex="-1"></a>df_sim <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb248-5"><a href="differential-abundance.html#cb248-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_id =</span> <span class="fu">colData</span>(tse)<span class="sc">$</span>sample_id,</span>
<span id="cb248-6"><a href="differential-abundance.html#cb248-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">length</span>(<span class="fu">colData</span>(tse)<span class="sc">$</span>sample_id))</span>
<span id="cb248-7"><a href="differential-abundance.html#cb248-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb248-8"><a href="differential-abundance.html#cb248-8" aria-hidden="true" tabindex="-1"></a><span class="co"># an easy way to join data is to use dplyr functions. The package </span></span>
<span id="cb248-9"><a href="differential-abundance.html#cb248-9" aria-hidden="true" tabindex="-1"></a><span class="co"># tidySummarizedExperiment enables this functionality</span></span>
<span id="cb248-10"><a href="differential-abundance.html#cb248-10" aria-hidden="true" tabindex="-1"></a>tse <span class="ot">&lt;-</span> <span class="fu">full_join</span>(tse, df_sim, <span class="at">by =</span> <span class="st">&quot;sample_id&quot;</span>)</span>
<span id="cb248-11"><a href="differential-abundance.html#cb248-11" aria-hidden="true" tabindex="-1"></a><span class="co"># now the data from df_sim is in the tse object and we can again repeat</span></span>
<span id="cb248-12"><a href="differential-abundance.html#cb248-12" aria-hidden="true" tabindex="-1"></a><span class="co"># the steps as above:</span></span>
<span id="cb248-13"><a href="differential-abundance.html#cb248-13" aria-hidden="true" tabindex="-1"></a>pseq <span class="ot">&lt;-</span> <span class="fu">makePhyloseqFromTreeSummarizedExperiment</span>(tse)</span>
<span id="cb248-14"><a href="differential-abundance.html#cb248-14" aria-hidden="true" tabindex="-1"></a>out_cov <span class="ot">=</span> <span class="fu">ancombc</span>(</span>
<span id="cb248-15"><a href="differential-abundance.html#cb248-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">phyloseq =</span> pseq, </span>
<span id="cb248-16"><a href="differential-abundance.html#cb248-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> <span class="st">&quot;pheno + age&quot;</span>, <span class="co"># here we add age to the model</span></span>
<span id="cb248-17"><a href="differential-abundance.html#cb248-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">p_adj_method =</span> <span class="st">&quot;fdr&quot;</span>, </span>
<span id="cb248-18"><a href="differential-abundance.html#cb248-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">zero_cut =</span> <span class="fl">0.90</span>, </span>
<span id="cb248-19"><a href="differential-abundance.html#cb248-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">lib_cut =</span> <span class="dv">0</span>, </span>
<span id="cb248-20"><a href="differential-abundance.html#cb248-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">&quot;pheno&quot;</span>, </span>
<span id="cb248-21"><a href="differential-abundance.html#cb248-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">struc_zero =</span> <span class="cn">TRUE</span>, </span>
<span id="cb248-22"><a href="differential-abundance.html#cb248-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">neg_lb =</span> <span class="cn">TRUE</span>, </span>
<span id="cb248-23"><a href="differential-abundance.html#cb248-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">tol =</span> <span class="fl">1e-5</span>, </span>
<span id="cb248-24"><a href="differential-abundance.html#cb248-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_iter =</span> <span class="dv">100</span>, </span>
<span id="cb248-25"><a href="differential-abundance.html#cb248-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">conserve =</span> <span class="cn">TRUE</span>, </span>
<span id="cb248-26"><a href="differential-abundance.html#cb248-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="fl">0.05</span>, </span>
<span id="cb248-27"><a href="differential-abundance.html#cb248-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">global =</span> <span class="cn">TRUE</span></span>
<span id="cb248-28"><a href="differential-abundance.html#cb248-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb248-29"><a href="differential-abundance.html#cb248-29" aria-hidden="true" tabindex="-1"></a><span class="co"># now the model answers the question: holding age constant, are </span></span>
<span id="cb248-30"><a href="differential-abundance.html#cb248-30" aria-hidden="true" tabindex="-1"></a><span class="co"># bacterial taxa differentially abundant? Or, if that is of interest,</span></span>
<span id="cb248-31"><a href="differential-abundance.html#cb248-31" aria-hidden="true" tabindex="-1"></a><span class="co"># holding phenotype constant, is age associated with bacterial abundance?</span></span>
<span id="cb248-32"><a href="differential-abundance.html#cb248-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Again we only show the first 6 entries.</span></span>
<span id="cb248-33"><a href="differential-abundance.html#cb248-33" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(out_cov<span class="sc">$</span>res<span class="sc">$</span>diff_abn))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">phenoObese</th>
<th align="left">age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Acetanaerobacterium</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">Acetivibrio</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">Acidaminococcus</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">Akkermansia</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">Alistipes</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">Allisonella</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
<p>In the next section of this book chapter we cover methods that can also take
into account the phylogenetic information of bacterial taxa to perform
group-wise associations.</p>
</div>
</div>
<div id="tree-based-methods" class="section level2" number="11.2">
<h2><span class="header-section-number">11.2</span> Tree-based methods</h2>
<div id="group-wise-associations-testing-based-on-balances-with-fido" class="section level3" number="11.2.1">
<h3><span class="header-section-number">11.2.1</span> Group-wise associations testing based on balances with fido</h3>
<p><a href="https://bioconductor.org/packages/release/bioc/html/TreeSummarizedExperiment.html">TreeSummarizedExperiment</a>
frequently includes a Phylogenetic tree along with associated data about the
experiment (at <code>colData</code>), that holds covariates which can be used for
analyzing group-wise associations.</p>
<p>Such an analysis could be performed with the function <code>pibble</code> from the <code>fido</code>
package, that offers a Multinomial Logistic-Normal Linear Regression model; see
<a href="https://jsilve24.github.io/fido/articles/introduction-to-fido.html">vignette</a> of package.</p>
<p>The following presents such an exemplary analysis based on the
<a href="https://doi.org/10.1038/s41467-020-17541-6">Sprockett et al. (2020)</a> available
through <code>microbiomeDataSets</code> package.</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="differential-abundance.html#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(fido)){</span>
<span id="cb249-2"><a href="differential-abundance.html#cb249-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># installing the fido package</span></span>
<span id="cb249-3"><a href="differential-abundance.html#cb249-3" aria-hidden="true" tabindex="-1"></a>  devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;jsilve24/fido&quot;</span>)</span>
<span id="cb249-4"><a href="differential-abundance.html#cb249-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## driver       (NA -&gt; 16e449946...) [GitHub]
## distribut... (NA -&gt; 0.2.2       ) [CRAN]
## tensorA      (NA -&gt; 0.36.2      ) [CRAN]
## checkmate    (NA -&gt; 2.0.0       ) [CRAN]
## svUnit       (NA -&gt; 1.0.6       ) [CRAN]
## HDInterval   (NA -&gt; 0.2.2       ) [CRAN]
## posterior    (NA -&gt; 1.0.1       ) [CRAN]
## arrayhelpers (NA -&gt; 1.1-0       ) [CRAN]
## ggdist       (NA -&gt; 3.0.0       ) [CRAN]
## RcppNumer... (NA -&gt; 0.4-0       ) [CRAN]
## tidybayes    (NA -&gt; 3.0.1       ) [CRAN]
## 
##   
   checking for file ‘/tmp/RtmpqqDa0f/remotes13184c25a2a4/jsilve24-driver-16e4499/DESCRIPTION’ ...
  
✔  checking for file ‘/tmp/RtmpqqDa0f/remotes13184c25a2a4/jsilve24-driver-16e4499/DESCRIPTION’
## 
  
─  preparing ‘driver’:
## 
  
   checking DESCRIPTION meta-information ...
  
✔  checking DESCRIPTION meta-information
## 
  
─  checking for LF line-endings in source and make files and shell scripts
## 
  
─  checking for empty or unneeded directories
##    Omitted ‘LazyData’ from DESCRIPTION
## 
  
─  building ‘driver_0.1.1.tar.gz’
## 
  
   
## 
  
   checking for file ‘/tmp/RtmpqqDa0f/remotes131843a84f056/jsilve24-fido-c692141/DESCRIPTION’ ...
  
✔  checking for file ‘/tmp/RtmpqqDa0f/remotes131843a84f056/jsilve24-fido-c692141/DESCRIPTION’
## 
  
─  preparing ‘fido’:
##    checking DESCRIPTION meta-information ...
  
✔  checking DESCRIPTION meta-information
## 
  
─  cleaning src
## ─  running ‘cleanup’
## 
  
   Warning: /tmp/RtmpKI4YRh/Rbuild132ea1c9b2d62/fido/man/loglikPibbleCollapsed.Rd:28: unknown macro &#39;\item&#39;
##    Warning: /tmp/RtmpKI4YRh/Rbuild132ea1c9b2d62/fido/man/loglikPibbleCollapsed.Rd:30: unknown macro &#39;\item&#39;
##    Warning: /tmp/RtmpKI4YRh/Rbuild132ea1c9b2d62/fido/man/loglikPibbleCollapsed.Rd:33: unexpected section header &#39;\value&#39;
## 
  
   Warning: /tmp/RtmpKI4YRh/Rbuild132ea1c9b2d62/fido/man/loglikPibbleCollapsed.Rd:41: unexpected section header &#39;\description&#39;
##    Warning: /tmp/RtmpKI4YRh/Rbuild132ea1c9b2d62/fido/man/loglikPibbleCollapsed.Rd:51: unexpected section header &#39;\examples&#39;
##    Warning: /tmp/RtmpKI4YRh/Rbuild132ea1c9b2d62/fido/man/loglikPibbleCollapsed.Rd:83: unexpected END_OF_INPUT &#39;
##    &#39;
## 
  
─  checking for LF line-endings in source and make files and shell scripts
## 
  
─  checking for empty or unneeded directories
## 
  
─  building ‘fido_0.1.13.tar.gz’
## 
  
   
## </code></pre>
<p>Loading the libraries and importing data:</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="differential-abundance.html#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fido)</span>
<span id="cb251-2"><a href="differential-abundance.html#cb251-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mia)</span>
<span id="cb251-3"><a href="differential-abundance.html#cb251-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(microbiomeDataSets)</span>
<span id="cb251-4"><a href="differential-abundance.html#cb251-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-5"><a href="differential-abundance.html#cb251-5" aria-hidden="true" tabindex="-1"></a>tse <span class="ot">&lt;-</span> <span class="fu">SprockettTHData</span>()</span></code></pre></div>
<p>We pick three covariates (“Sex,”“Age_Years,”“Delivery_Mode”) during this
analysis as an example, and beforehand we check for missing data:</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="differential-abundance.html#cb252-1" aria-hidden="true" tabindex="-1"></a>cov_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Sex&quot;</span>,<span class="st">&quot;Age_Years&quot;</span>,<span class="st">&quot;Delivery_Mode&quot;</span>)</span>
<span id="cb252-2"><a href="differential-abundance.html#cb252-2" aria-hidden="true" tabindex="-1"></a>na_counts <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">is.na</span>(<span class="fu">colData</span>(tse)[,cov_names]), <span class="dv">2</span>, sum)</span>
<span id="cb252-3"><a href="differential-abundance.html#cb252-3" aria-hidden="true" tabindex="-1"></a>na_summary<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(na_counts,<span class="at">row.names=</span>cov_names)</span></code></pre></div>
<p>We drop samples with na values at the covariates (features) under analysis:</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="differential-abundance.html#cb253-1" aria-hidden="true" tabindex="-1"></a>tse <span class="ot">&lt;-</span> tse[ , <span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">colData</span>(tse)<span class="sc">$</span>Delivery_Mode) ]</span>
<span id="cb253-2"><a href="differential-abundance.html#cb253-2" aria-hidden="true" tabindex="-1"></a>tse <span class="ot">&lt;-</span> tse[ , <span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">colData</span>(tse)<span class="sc">$</span>Age_Years) ]</span></code></pre></div>
<p>We agglomerate the data at a Phylum rank.
Note: Large assay data (along with the covariates/features data) could prevent the analysis later,
since the computation will construct matrices that would not always fit memory.</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="differential-abundance.html#cb254-1" aria-hidden="true" tabindex="-1"></a>tse_phylum <span class="ot">&lt;-</span> <span class="fu">agglomerateByRank</span>(tse, <span class="st">&quot;Phylum&quot;</span>)</span></code></pre></div>
<p>We extract the counts assay and feature data to build the model matrix having
an extra row of ones presenting the intercept for the regression task later:</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="differential-abundance.html#cb255-1" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">assays</span>(tse_phylum)<span class="sc">$</span>counts</span>
<span id="cb255-2"><a href="differential-abundance.html#cb255-2" aria-hidden="true" tabindex="-1"></a><span class="co"># design matrix</span></span>
<span id="cb255-3"><a href="differential-abundance.html#cb255-3" aria-hidden="true" tabindex="-1"></a><span class="co"># taking 3 covariates</span></span>
<span id="cb255-4"><a href="differential-abundance.html#cb255-4" aria-hidden="true" tabindex="-1"></a>sample_data<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">colData</span>(tse_phylum)[,cov_names])</span>
<span id="cb255-5"><a href="differential-abundance.html#cb255-5" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">model.matrix</span>(<span class="sc">~</span>Sex<span class="sc">+</span>Age_Years<span class="sc">+</span>Delivery_Mode,<span class="at">data=</span>sample_data))</span></code></pre></div>
<p>Building the parameters for the <code>pibble</code> call to build the model; see more at <a href="https://jsilve24.github.io/fido/articles/introduction-to-fido.html">vignette</a>:</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="differential-abundance.html#cb256-1" aria-hidden="true" tabindex="-1"></a>n_taxa<span class="ot">&lt;-</span><span class="fu">nrow</span>(Y)</span>
<span id="cb256-2"><a href="differential-abundance.html#cb256-2" aria-hidden="true" tabindex="-1"></a>upsilon <span class="ot">&lt;-</span> n_taxa<span class="sc">+</span><span class="dv">3</span></span>
<span id="cb256-3"><a href="differential-abundance.html#cb256-3" aria-hidden="true" tabindex="-1"></a>Omega <span class="ot">&lt;-</span> <span class="fu">diag</span>(n_taxa)</span>
<span id="cb256-4"><a href="differential-abundance.html#cb256-4" aria-hidden="true" tabindex="-1"></a>G <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">diag</span>(n_taxa<span class="dv">-1</span>), <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb256-5"><a href="differential-abundance.html#cb256-5" aria-hidden="true" tabindex="-1"></a>Xi <span class="ot">&lt;-</span> (upsilon<span class="sc">-</span>n_taxa)<span class="sc">*</span>G<span class="sc">%*%</span>Omega<span class="sc">%*%</span><span class="fu">t</span>(G)</span>
<span id="cb256-6"><a href="differential-abundance.html#cb256-6" aria-hidden="true" tabindex="-1"></a>Theta <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, n_taxa<span class="dv">-1</span>, <span class="fu">nrow</span>(X))</span>
<span id="cb256-7"><a href="differential-abundance.html#cb256-7" aria-hidden="true" tabindex="-1"></a>Gamma <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="fu">nrow</span>(X))</span></code></pre></div>
<p>Automatically initializing the priors and visualizing their distributions:</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="differential-abundance.html#cb257-1" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span> <span class="fu">pibble</span>(<span class="cn">NULL</span>, X, upsilon, Theta, Gamma, Xi)</span>
<span id="cb257-2"><a href="differential-abundance.html#cb257-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names_covariates</span>(priors) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(X)</span>
<span id="cb257-3"><a href="differential-abundance.html#cb257-3" aria-hidden="true" tabindex="-1"></a>fido<span class="sc">::</span><span class="fu">plot</span>(priors, <span class="at">pars=</span><span class="st">&quot;Lambda&quot;</span>) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">xlim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">5</span>))</span></code></pre></div>
<p><img src="30_differential_abundance_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>Estimating the posterior by including the data at <code>Y</code>.
Note: Some computational failures could occur (see <a href="https://github-wiki-see.page/m/jsilve24/fido/wiki/Frequently-Asked-Questions">discussion</a>)
the arguments <code>multDirichletBoot</code> <code>calcGradHess</code> could be passed in such case.</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="differential-abundance.html#cb258-1" aria-hidden="true" tabindex="-1"></a>priors<span class="sc">$</span>Y <span class="ot">&lt;-</span> Y </span>
<span id="cb258-2"><a href="differential-abundance.html#cb258-2" aria-hidden="true" tabindex="-1"></a>posterior <span class="ot">&lt;-</span> <span class="fu">refit</span>(priors, <span class="at">optim_method=</span><span class="st">&quot;adam&quot;</span>, <span class="at">multDirichletBoot=</span><span class="fl">0.5</span>) <span class="co"># ,, calcGradHess=FALSE</span></span></code></pre></div>
<p>Printing a summary about the posterior predictive distribution:</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="differential-abundance.html#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ppc_summary</span>(posterior)</span></code></pre></div>
<pre><code>## Proportions of Observations within 95% Credible Interval: 0.998</code></pre>
<p>Plotting the summary of the posterior distributions of the regression parameters:</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="differential-abundance.html#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names_categories</span>(posterior) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(Y)</span>
<span id="cb261-2"><a href="differential-abundance.html#cb261-2" aria-hidden="true" tabindex="-1"></a>fido<span class="sc">::</span><span class="fu">plot</span>(posterior,<span class="at">par=</span><span class="st">&quot;Lambda&quot;</span>,<span class="at">focus.cov=</span><span class="fu">rownames</span>(X)[<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>])</span></code></pre></div>
<p><img src="30_differential_abundance_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>Seemingly the covariate “Age_Years” does not have effect on the model as “Delivery_Mode” would,
and “Sex” to some extent. Let’s take a closer look at the two latter ones:</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="differential-abundance.html#cb262-1" aria-hidden="true" tabindex="-1"></a>fido<span class="sc">::</span><span class="fu">plot</span>(posterior, <span class="at">par=</span><span class="st">&quot;Lambda&quot;</span>, <span class="at">focus.cov =</span> <span class="fu">rownames</span>(X)[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>)])</span></code></pre></div>
<p><img src="30_differential_abundance_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
</div>
</div>
<div id="session-info-6" class="section level2 unnumbered">
<h2>Session Info</h2>
<button class="rebook-collapse">
View session info
</button>
<div class="rebook-content">
<pre><code>R version 4.1.1 (2021-08-10)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 20.04.3 LTS

Matrix products: default
BLAS/LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.8.so

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=C             
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] stats4    stats     graphics  grDevices utils     datasets  methods  
[8] base     

other attached packages:
 [1] microbiomeDataSets_1.1.5       MultiAssayExperiment_1.19.11  
 [3] fido_0.1.13                    forcats_0.5.1                 
 [5] stringr_1.4.0                  dplyr_1.0.7                   
 [7] purrr_0.3.4                    readr_2.0.1                   
 [9] tidyr_1.1.3                    tibble_3.1.4                  
[11] ggplot2_3.3.5                  tidyverse_1.3.1               
[13] knitr_1.33                     Maaslin2_1.7.2                
[15] ALDEx2_1.25.1                  zCompositions_1.3.4           
[17] truncnorm_1.0-8                NADA_1.6-1.1                  
[19] survival_3.2-13                MASS_7.3-54                   
[21] ANCOMBC_1.3.2                  tidySummarizedExperiment_1.3.0
[23] patchwork_1.1.1                mia_1.1.14                    
[25] TreeSummarizedExperiment_2.1.4 Biostrings_2.61.2             
[27] XVector_0.33.0                 SingleCellExperiment_1.15.2   
[29] SummarizedExperiment_1.23.4    Biobase_2.53.0                
[31] GenomicRanges_1.45.0           GenomeInfoDb_1.29.8           
[33] IRanges_2.27.2                 S4Vectors_0.31.3              
[35] BiocGenerics_0.39.2            MatrixGenerics_1.5.4          
[37] matrixStats_0.60.1-9001        BiocStyle_2.21.3              
[39] rebook_1.3.1                  

loaded via a namespace (and not attached):
  [1] rappdirs_0.3.3                coda_0.19-4                  
  [3] bit64_4.0.5                   irlba_2.3.3                  
  [5] DelayedArray_0.19.2           data.table_1.14.0            
  [7] KEGGREST_1.33.0               RCurl_1.98-1.4               
  [9] generics_0.1.0                ScaledMatrix_1.1.0           
 [11] callr_3.7.0                   microbiome_1.15.0            
 [13] usethis_2.0.1                 RSQLite_2.2.8                
 [15] bit_4.0.4                     tzdb_0.1.2                   
 [17] httpuv_1.6.2                  xml2_1.3.2                   
 [19] lubridate_1.7.10              assertthat_0.2.1             
 [21] DirichletMultinomial_1.35.0   viridis_0.6.1                
 [23] xfun_0.25                     ggdist_3.0.0                 
 [25] hms_1.1.0                     jquerylib_0.1.4              
 [27] promises_1.2.0.1              evaluate_0.14                
 [29] DEoptimR_1.0-9                fansi_0.5.0                  
 [31] dbplyr_2.1.1                  readxl_1.3.1                 
 [33] igraph_1.2.6                  DBI_1.1.1                    
 [35] htmlwidgets_1.5.4             tensorA_0.36.2               
 [37] hash_2.2.6.1                  ellipsis_0.3.2               
 [39] backports_1.2.1               bookdown_0.24                
 [41] permute_0.9-5                 sparseMatrixStats_1.5.3      
 [43] vctrs_0.3.8                   remotes_2.4.0                
 [45] abind_1.4-5                   tidybayes_3.0.1              
 [47] cachem_1.0.6                  withr_2.4.2                  
 [49] robustbase_0.93-8             checkmate_2.0.0              
 [51] vegan_2.5-7                   treeio_1.17.2                
 [53] prettyunits_1.1.1             getopt_1.20.3                
 [55] cluster_2.1.2                 ExperimentHub_2.1.4          
 [57] ape_5.5                       dir.expiry_1.1.0             
 [59] lazyeval_0.2.2                crayon_1.4.1                 
 [61] pkgconfig_2.0.3               labeling_0.4.2               
 [63] nlme_3.1-153                  vipor_0.4.5                  
 [65] pkgload_1.2.1                 devtools_2.4.2               
 [67] rlang_0.4.11                  lifecycle_1.0.0              
 [69] filelock_1.0.2                BiocFileCache_2.1.1          
 [71] phyloseq_1.37.0               modelr_0.1.8                 
 [73] rsvd_1.0.5                    AnnotationHub_3.1.5          
 [75] distributional_0.2.2          cellranger_1.1.0             
 [77] rprojroot_2.0.2               graph_1.71.2                 
 [79] Matrix_1.3-4                  lpsymphony_1.21.0            
 [81] Rhdf5lib_1.15.2               reprex_2.0.1                 
 [83] beeswarm_0.4.0                processx_3.5.2               
 [85] png_0.1-7                     viridisLite_0.4.0            
 [87] bitops_1.0-7                  rhdf5filters_1.5.0           
 [89] blob_1.2.2                    DelayedMatrixStats_1.15.4    
 [91] decontam_1.13.0               DECIPHER_2.21.0              
 [93] beachmat_2.9.1                scales_1.1.1                 
 [95] memoise_2.0.0                 magrittr_2.0.1               
 [97] plyr_1.8.6                    zlibbioc_1.39.0              
 [99] compiler_4.1.1                driver_0.1.1                 
[101] RColorBrewer_1.1-2            cli_3.0.1                    
[103] ade4_1.7-17                   pbapply_1.4-3                
[105] ps_1.6.0                      mgcv_1.8-36                  
[107] tidyselect_1.1.1              stringi_1.7.4                
[109] highr_0.9                     yaml_2.2.1                   
[111] BiocSingular_1.9.1            svUnit_1.0.6                 
[113] ggrepel_0.9.1                 grid_4.1.1                   
[115] sass_0.4.0                    tools_4.1.1                  
[117] parallel_4.1.1                rstudioapi_0.13              
[119] foreach_1.5.1                 logging_0.10-108             
[121] optparse_1.6.6                gridExtra_2.3                
[123] posterior_1.0.1               farver_2.1.0                 
[125] Rtsne_0.15                    RcppZiggurat_0.1.6           
[127] digest_0.6.27                 BiocManager_1.30.16          
[129] shiny_1.6.0                   Rcpp_1.0.7                   
[131] broom_0.7.9                   scuttle_1.3.1                
[133] later_1.3.0                   BiocVersion_3.14.0           
[135] AnnotationDbi_1.55.1          httr_1.4.2                   
[137] Rdpack_2.1.2                  colorspace_2.0-2             
[139] rvest_1.0.1                   XML_3.99-0.7                 
[141] fs_1.5.0                      splines_4.1.1                
[143] tidytree_0.3.5                scater_1.21.3                
[145] multtest_2.49.0               plotly_4.9.4.1               
[147] sessioninfo_1.1.1             xtable_1.8-4                 
[149] jsonlite_1.7.2                nloptr_1.2.2.2               
[151] CodeDepends_0.6.5             Rfast_2.0.3                  
[153] testthat_3.0.4                R6_2.5.1                     
[155] mime_0.11                     pillar_1.6.2                 
[157] htmltools_0.5.2               glue_1.4.2                   
[159] fastmap_1.1.0                 BiocParallel_1.27.6          
[161] BiocNeighbors_1.11.0          interactiveDisplayBase_1.31.2
[163] codetools_0.2-18              pkgbuild_1.2.0               
[165] pcaPP_1.9-74                  mvtnorm_1.1-2                
[167] utf8_1.2.2                    lattice_0.20-44              
[169] bslib_0.3.0                   arrayhelpers_1.1-0           
[171] curl_4.3.2                    ggbeeswarm_0.6.0             
[173] biglm_0.9-2.1                 rmarkdown_2.10               
[175] desc_1.3.0                    biomformat_1.21.0            
[177] munsell_0.5.0                 rhdf5_2.37.3                 
[179] GenomeInfoDbData_1.2.6        iterators_1.0.13             
[181] haven_2.4.3                   reshape2_1.4.4               
[183] gtable_0.3.0                  rbibutils_2.2.3              </code></pre>
</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="community-typing.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="multitable.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": true,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["OMA.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
